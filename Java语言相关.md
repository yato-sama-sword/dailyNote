Java

## IO

### 简介

用户程序执行I/O操作必须通过**系统调用**，一般来说磁盘IO和网络IO是接触到更多的。**从应用程序的视角来看的话，我们的应用程序对操作系统的内核发起 IO 调用（系统调用），操作系统负责的内核执行具体的 IO 操作。也就是说，我们的应用程序实际上只是发起了 IO 操作的调用而已，具体 IO 的执行是由操作系统的内核来完成的。**

当应用程序发起 I/O 调用后，会经历两个步骤：

1. 内核等待 I/O 设备准备好数据
2. 内核将数据从内核空间拷贝到用户空间。

UNIX中常有5种模型：同步阻塞I/O、同步非阻塞I/O、I/O多路复用、信号驱动I/O、异步I/O。

**Java中有BIO、NIO、AIO三种常见模型**

### 装饰者模式在IO中的应用

> **结构图：**
> 
> Filter InputStream是抽象装饰者，InputStream为抽象组件，其余为具体组件
> 
> ![image](file://C:\Users\yato\Desktop\U know wt\面试准备\dailyNote\笔记.assets\DP-Decorator-java.io.png?msec=1657797480992)

```java
FileInputStream fileInputStream = new FileInputStream(filePath);
BufferedInputStream bufferedInputStream = new BufferedInputStream(fileInputStream);
```

## JVM

> 结合深入理解Java虚拟机，配合pdai.tech、javaGudie一同学习，非常好用

### 类字节码

#### 目标

实现“一次编译，到处运行”运行的口号，计算机无法直接识别java语言，通过javac编译器将java语言编译成**.class(字节码)**之后，JVM虚拟机可以去读取执行。

#### 实质

是以8位字节为基础单位的二进制流

#### 结构属性

1. 魔数与class文件版本：很经典的咖啡宝贝(0xCAFEBABE)，标记当前文件为class文件
2. 常量池：存储有变量的属性，类型和名称，方法的属性、类型和名称等等
3. 访问标志：标记属性和访问类型
4. 索引：class文件通过类索引、父类索引、接口索引三项数据确定类的继承关系
5. 字段表属性：描述接口或类中声明的变量，比如变量作用域、是否是静态变量、可变性、数据类型等等
6. 方法表属性：与字段表类似，但是是方法表
7. 属性表属性：用于描述某些场景的专有信息。比如字段表中特殊属性、方法表中的特殊的属性等等

#### 反编译工具

神奇的javap，用法: `javap <options> <classes>`

### 类加载机制

类加载大体上分为加载、验证、准备、解析、初始化五步，其中验证、准备、解析被统称为连接

完整的生命周期如下

![img](file://C:\Users\yato\Desktop\U know wt\面试准备\dailyNote\笔记.assets\类加载过程-完善.png?msec=1657797480992)

#### 加载-查找并加载类的二进制文件

1. 通过类的全限定名获取类的二进制字节流
2. 将字节流代表的静态存储结构转换为方法区的运行时数据结构
3. 在内存中生成一个代表该类的 `Class` 对象，作为方法区这些数据的访问入口

#### 验证-确保被加载的类的正确性

1. 文件格式验证：验证魔数、版本号、常量类型等等
2. 元数据验证：进行语义分析，保证描述信息符合Java语言规范要求
3. 字节码验证：确保程序语义合法、符合逻辑的。保证操作数栈和指令代码序列都能配合工作
4. 符号引用验证：确保解析动作能正确执行

#### 准备-正式为类变量分配内存并设置类初始值

1. 内存分配类变量（静态变量，不分配实例变量
2. 类变量使用内存在方法区中分配（字符串常量池、静态变量会移动到堆中
3. 初始值“通常情况”是数据类型默认零值

#### 解析-将常量池符号引用替换为直接引用

符号引用就是一组描述目标的字面量。比如引用的类名或者啥的。直接引用就是直接指向目标的指针、相对偏移量或一个间接定位到目标的句柄。

#### 初始化-执行初始化<cinit()>方法

这一步JVM才开始真正执行类中定义的字节码，只有主动使用类才会执行类的初始化

### 类加载器

#### 种类

#### 双亲委派模型

### 内存结构

### 内存模型

### GC

### 调试排错

## Java多线程

> 借助《深入浅出Java多线程一书》，重新整理下自己学过的JUC相关知识

### 基础篇

#### 1.进程与线程的基本概念

> 背景知识：一开始的计算机是用户输入指令，对应计算机执行一个操作，效率相当低下。在引入批处理操作系统后，用户可以把一系列需要进行操作的指令写下来，形成一个清单，一次性交给计算机，计算机一次性执行所有操作。**但是，批处理操作系统的指令运行方式仍然是串行的，内存中始终只有一个程序在运行。**内存中能不能有多个程序同时运行？进程应运而生。**进程是应用程序在内存中分配的空间，也就是正在运行的程序。**塔噶，在一开始CPU是采用时间片轮转的方式来运行进程，CPU会为每个进程分配一个时间段。这个时候从宏观上来看，一个大的时间片内同时有多个任务在执行，但是实际上对于单核CPU而言，具体时刻下还是只有一个任务能够使用CPU资源。那么有没有一种可能，一个进程可以同时执行多个子任务呢？线程应运而生。**线程负责单个的子任务，一个进程包含多个线程**。（用操作系统里的话说，进程是资源的最小分配单位，线程是CPU调度的最小单位）

# Comm Tools
